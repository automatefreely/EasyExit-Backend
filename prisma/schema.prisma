// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client ***REMOVED***
***REMOVED***provider = "prisma-client-js"
***REMOVED***

datasource db ***REMOVED***
***REMOVED***provider***REMOVED******REMOVED*** = "mysql"
***REMOVED***url***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***= env("DATABASE_URL")
***REMOVED***relationMode = "prisma"
***REMOVED***

/// User schema
model User ***REMOVED***
***REMOVED***email***REMOVED******REMOVED*** String***REMOVED*** @id
***REMOVED***name***REMOVED******REMOVED******REMOVED***String?
***REMOVED***password***REMOVED***String?
***REMOVED***createdAt DateTime @default(now())
***REMOVED***updatedAt DateTime @updatedAt
***REMOVED***admin***REMOVED******REMOVED*** Admin?
***REMOVED***checker***REMOVED*** Checker?
***REMOVED***peoples***REMOVED*** Peoples?
***REMOVED***manager***REMOVED*** Manager?
***REMOVED***

/// Admin creates organizations, add users and assigns roles to users like people, manager, checker
model Admin ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Manager can approve the token request
model Manager ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Checker can check the token status and check entry and exit
model Checker ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Organization schema
model Organization ***REMOVED***
***REMOVED***id***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED***@id @default(uuid())
***REMOVED***name***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String
***REMOVED***createdAt***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** DateTime***REMOVED***@default(now())
***REMOVED***updatedAt***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** DateTime***REMOVED***@updatedAt
***REMOVED***peoples***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Peoples[]
***REMOVED***admin***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Admin[]
***REMOVED***checker***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Checker[]
***REMOVED***Manager***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Manager[]
***REMOVED***unrestrictedStartTime DateTime***REMOVED***@db.Time() @default(dbgenerated("100000"))
***REMOVED***unrestrictedEndTime***REMOVED*** DateTime***REMOVED***@db.Time() @default(dbgenerated("180000"))

***REMOVED***@@index([id, name])
***REMOVED***

/// Students schema
model Peoples ***REMOVED***
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([organizationId])
***REMOVED***@@index([email])
***REMOVED***

/// Token Status
enum TokenStatus ***REMOVED***
***REMOVED***REQUESTED
***REMOVED***ISSUED
***REMOVED***REJECTED
***REMOVED***// When user is not late and returned
***REMOVED***EXPIRED
***REMOVED***IN_USE
***REMOVED***RETURNED_BEFORE_ISSUED
***REMOVED***RETURNED_AFTER_ISSUED
***REMOVED***LATE
***REMOVED***

/// Token schema
model Token ***REMOVED***
***REMOVED***token***REMOVED***String @id @default(uuid())
***REMOVED***reason String

***REMOVED***createdAt DateTime @default(now())
***REMOVED***updatedAt DateTime @updatedAt

***REMOVED***issuedBy***REMOVED******REMOVED******REMOVED*** Peoples***REMOVED******REMOVED*** @relation(fields: [issuedById], references: [email])
***REMOVED***issuedById***REMOVED******REMOVED*** String
***REMOVED***organizationId String
***REMOVED***status***REMOVED******REMOVED******REMOVED******REMOVED*** TokenStatus @default(REQUESTED)

***REMOVED***startTime DateTime
***REMOVED***endTime***REMOVED*** DateTime

***REMOVED***acceptedTime***REMOVED***DateTime
***REMOVED***acceptedBy***REMOVED******REMOVED***Manager? @relation(fields: [acceptedByUid], references: [email])
***REMOVED***acceptedByUid String

***REMOVED***exitTime***REMOVED******REMOVED*** DateTime
***REMOVED***returnedTime DateTime

***REMOVED***checkedBy***REMOVED******REMOVED***Checker? @relation(fields: [checkedByUid], references: [email])
***REMOVED***checkedByUid String

***REMOVED***lateEntry lateEntry?

***REMOVED***@@index([token])
***REMOVED***@@index([issuedById, organizationId])
***REMOVED***@@index([acceptedByUid, organizationId])
***REMOVED***@@index([checkedByUid, organizationId])
***REMOVED***

/// Late Entry
model lateEntry ***REMOVED***
***REMOVED***referedToken***REMOVED******REMOVED******REMOVED***Token***REMOVED******REMOVED***@relation(fields: [token], references: [token])
***REMOVED***token***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** String***REMOVED*** @id
***REMOVED***expectedEntryTime DateTime

***REMOVED***reason***REMOVED******REMOVED***String
***REMOVED***createdAt DateTime @default(now())

***REMOVED***@@index([token])
***REMOVED***
