// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client ***REMOVED***
***REMOVED***provider = "prisma-client-js"
***REMOVED***previewFeatures = ["fullTextSearch","fullTextIndex"]
***REMOVED***

datasource db ***REMOVED***
***REMOVED***provider***REMOVED******REMOVED*** = "mysql"
***REMOVED***url***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***= env("DATABASE_URL")
***REMOVED***relationMode = "prisma"
***REMOVED***

/// User schema
model User ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED*** String***REMOVED*** @id
***REMOVED***name***REMOVED******REMOVED******REMOVED******REMOVED***String?
***REMOVED***password***REMOVED******REMOVED***String?
***REMOVED***profileImg***REMOVED***String?
***REMOVED***phoneNumber Int?
***REMOVED***createdAt***REMOVED*** DateTime @default(now())
***REMOVED***updatedAt***REMOVED*** DateTime @updatedAt
***REMOVED***admin***REMOVED******REMOVED******REMOVED*** Admin?
***REMOVED***checker***REMOVED******REMOVED*** Checker?
***REMOVED***peoples***REMOVED******REMOVED*** Peoples?
***REMOVED***manager***REMOVED******REMOVED*** Manager?

***REMOVED***notificationSent Notifications[]
***REMOVED***

/// Admin creates organizations, add users and assigns roles to users like people, manager, checker
model Admin ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Manager can approve the token request
model Manager ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Checker can check the token status and check entry and exit
model Checker ***REMOVED***
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([email])
***REMOVED***@@index([organizationId])
***REMOVED***

/// Organization schema
model Organization ***REMOVED***
***REMOVED***id***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED***@id @default(uuid())
***REMOVED***name***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String
***REMOVED***createdAt***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** DateTime***REMOVED***@default(now())
***REMOVED***updatedAt***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** DateTime***REMOVED***@updatedAt
***REMOVED***peoples***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Peoples[]
***REMOVED***admin***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Admin[]
***REMOVED***checker***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Checker[]
***REMOVED***manager***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** Manager[]
***REMOVED***unrestrictedStartTime DateTime***REMOVED***@default(dbgenerated("043000")) @db.Time()
***REMOVED***unrestrictedEndTime***REMOVED*** DateTime***REMOVED***@default(dbgenerated("123000")) @db.Time()
***REMOVED***organizationLogo***REMOVED******REMOVED******REMOVED***String?

***REMOVED***notifications Notifications[]

***REMOVED***@@index([id, name])
***REMOVED***

/// Students schema
model Peoples ***REMOVED***
***REMOVED***user***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** User***REMOVED******REMOVED******REMOVED******REMOVED*** @relation(fields: [email], references: [email])
***REMOVED***email***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String***REMOVED******REMOVED******REMOVED*** @id
***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String

***REMOVED***token Token[]

***REMOVED***@@index([organizationId])
***REMOVED***@@index([email])
***REMOVED***

/// Token Status
enum TokenStatus ***REMOVED***
***REMOVED***REQUESTED
***REMOVED***ISSUED
***REMOVED***REJECTED
***REMOVED***EXPIRED
***REMOVED***IN_USE
***REMOVED***LATE
***REMOVED***

/// Token schema
model Token ***REMOVED***
***REMOVED***token***REMOVED******REMOVED*** String***REMOVED*** @id @default(uuid())
***REMOVED***reason***REMOVED******REMOVED***String
***REMOVED***heading***REMOVED*** String
***REMOVED***createdAt DateTime @default(now())
***REMOVED***updatedAt DateTime @updatedAt

***REMOVED***issuedBy***REMOVED******REMOVED******REMOVED*** Peoples***REMOVED******REMOVED*** @relation(fields: [issuedById], references: [email])
***REMOVED***issuedById***REMOVED******REMOVED*** String
***REMOVED***organizationId String
***REMOVED***status***REMOVED******REMOVED******REMOVED******REMOVED*** TokenStatus @default(REQUESTED)

***REMOVED***startTime DateTime
***REMOVED***endTime***REMOVED*** DateTime

***REMOVED***acceptedBy***REMOVED******REMOVED***Manager? @relation(fields: [acceptedByUid], references: [email])
***REMOVED***acceptedByUid String?

***REMOVED***rejectionReason String?

***REMOVED***exitTime***REMOVED******REMOVED*** DateTime?
***REMOVED***returnedTime DateTime?

***REMOVED***checkedBy***REMOVED******REMOVED***Checker? @relation(fields: [checkedByUid], references: [email])
***REMOVED***checkedByUid String?

***REMOVED***lateEntry lateEntry?

***REMOVED***pass***REMOVED******REMOVED******REMOVED******REMOVED*** String?
***REMOVED***passValidity DateTime? @db.Time()

***REMOVED***@@index([token])
***REMOVED***@@index([issuedById, organizationId])
***REMOVED***@@index([acceptedByUid, organizationId])
***REMOVED***@@index([checkedByUid, organizationId])

***REMOVED***@@fulltext([reason, heading])
***REMOVED***

/// Late Entry
model lateEntry ***REMOVED***
***REMOVED***referedToken***REMOVED******REMOVED******REMOVED***Token***REMOVED******REMOVED***@relation(fields: [token], references: [token])
***REMOVED***token***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED******REMOVED*** String***REMOVED*** @id
***REMOVED***expectedEntryTime DateTime

***REMOVED***reason***REMOVED******REMOVED***String
***REMOVED***createdAt DateTime @default(now())

***REMOVED***@@index([token])
***REMOVED***

enum NotificationStatus ***REMOVED***
***REMOVED***SUCCESS
***REMOVED***FAILED
***REMOVED***INITIATED
***REMOVED***

enum NotificationTopic ***REMOVED***
***REMOVED***ANNOUNCEMENT
***REMOVED***PEOPLES
***REMOVED***MANAGER
***REMOVED***CHECKER
***REMOVED***

model Notifications ***REMOVED***
***REMOVED***notificaitonId String @id @default(uuid())
***REMOVED***title***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***String
***REMOVED***description***REMOVED******REMOVED***String

***REMOVED***organization***REMOVED*** Organization @relation(fields: [organizationId], references: [id])
***REMOVED***organizationId String
***REMOVED***topic***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***NotificationTopic

***REMOVED***notificationStatus NotificationStatus @default(INITIATED)

***REMOVED***sender***REMOVED******REMOVED******REMOVED***User***REMOVED******REMOVED*** @relation(fields: [senderEmail], references: [email])
***REMOVED***senderEmail String
***REMOVED***createdAt***REMOVED*** DateTime @default(now())

***REMOVED***@@index([organizationId])
***REMOVED***@@index([senderEmail])
***REMOVED***
